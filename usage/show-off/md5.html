<!doctype html>
<html class="fixed sidebar-light">
<head>
    <meta charset="UTF-8">

    <title>MD5 Example Â· swave</title>
    <meta name="keywords" content="scala, streams, streaming, reactive, asynchronous, non-blocking" />
    <meta name="description" content='A Reactive Streams infrastructure implementation in Scala'>
    <meta name="author" content="The swave team">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../../assets/css/theme.css" />
    <link rel="stylesheet" href="../../assets/css/skins/default.css" />
    <link rel="stylesheet" href="../../assets/css/theme-custom.css">
    <link rel="stylesheet" href="../../assets/vendor/highlight/github.css">

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="apple-mobile-web-app-title" content="swave.io">
    <meta name="application-name" content="swave.io">
    <meta name="theme-color" content="#ffffff">

    <script src="../../assets/vendor/modernizr/modernizr.js"></script>
</head>
<body >
<section class="body">

    <header class="header">
        <div class="logo-container">
            <a href="../../index.html" class="logo">
                <img src="../../assets/img/swave-logo.svg" height="35" alt="swave" />
            </a>
            <div class="visible-xs toggle-sidebar-left" data-toggle-class="sidebar-left-opened" data-target="html" data-fire-event="sidebar-left-opened">
                <i class="fa fa-bars" aria-label="Toggle sidebar"></i>
            </div>
        </div>

        <div class="header-right hidden-xs">
            <ul class="social-icons">
                <li class="social-icons-github"><a href="https://github.com/sirthias/swave/" target="_blank" title="Github"><i class="fa fa-github"></i></a></li>
                <li class="social-icons-email"><a href="https://groups.google.com/forum/#!forum/swave-user" target="_blank" title="Mailing List"><i class="fa fa-envelope"></i></a></li>
                <li class="social-icons-twitter"><a href="https://twitter.com/swaveio/" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></li>
            </ul>
            <div id="talks-link">
                <a href="../../introduction/talks-on-swave.html" title="Watch the latest introductory talks for swave!">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>&nbsp;
                    <i class="fa fa-video-camera" aria-hidden="true"></i>&nbsp;Watch an intro talk on swave!&nbsp;
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </header>

    <div class="inner-wrapper">
        <aside id="sidebar-left" class="sidebar-left">

            <div class="sidebar-header">
                <div class="sidebar-title">
                    Content
                </div>
                <div class="sidebar-toggle hidden-xs" data-toggle-class="sidebar-left-collapsed" data-target="html" data-fire-event="sidebar-left-toggle">
                    <i class="fa fa-bars" aria-label="Toggle sidebar"></i>
                </div>
            </div>

            <div class="nano">
                <div class="nano-content">
                    <nav id="menu" class="nav-main" role="navigation">
                        <ul class="nav nav-main">
                          <li class="nav-parent"><a><i class="fa fa-blind" aria-hidden="true"></i><span>Introduction</span></a>
                          <ul class="nav nav-children">
                            <li><a href="../../introduction/overview.html">Overview</a></li>
                            <li><a href="../../introduction/reactive-streams.html">Reactive Streams</a></li>
                            <li><a href="../../introduction/swave-vs-akka-stream.html"><em>swave</em> vs. Akka-Stream</a></li>
                            <li><a href="../../introduction/talks-on-swave.html">Talks on <em>swave</em></a></li>
                          </ul></li>
                          <li class="nav-parent nav-expanded nav-active"><a><i class="fa fa-book" aria-hidden="true"></i><span>User Documentation</span></a>
                          <ul class="nav nav-children">
                            <li class="nav-parent nav-expanded nav-active"><a>Show-Off</a>
                            <ul class="nav nav-children">
                              <li><a href="../../usage/show-off/overview.html">Show-Off Overview</a></li>
                              <li class="nav-expanded nav-active"><a href="../../usage/show-off/md5.html">MD5 Example</a></li>
                              <li><a href="../../usage/show-off/fahrenheit.html">Fahrenheit Example</a></li>
                              <li><a href="../../usage/show-off/monte-carlo-pi.html">Monte Carlo Pi Example</a></li>
                              <li><a href="../../usage/show-off/fibonacci.html">Fibonacci Example</a></li>
                            </ul></li>
                            <li><a href="../../usage/setup.html">Setup</a></li>
                            <li><a href="../../usage/quick-start.html">Quick Start</a></li>
                            <li><a href="../../usage/basics.html">Basics</a></li>
                            <li><a href="../../usage/spouts.html">Spouts</a></li>
                            <li><a href="../../usage/drains.html">Drains</a></li>
                            <li class="nav-parent"><a>Transformations</a>
                            <ul class="nav nav-children">
                              <li><a href="../../usage/transformations/overview.html">Transformations Overview</a></li>
                              <li><a href="../../usage/transformations/simple.html">Simple Transformations</a></li>
                              <li><a href="../../usage/transformations/fan-ins.html">Fan-Ins</a></li>
                              <li><a href="../../usage/transformations/fan-outs.html">Fan-Outs</a></li>
                              <li><a href="../../usage/transformations/streams-of-streams.html">Streams-of-Streams</a></li>
                              <li><a href="../../usage/transformations/relationships.html">Fan-In/Out Relationships</a></li>
                              <li><a href="../../usage/transformations/couplings.html">Couplings</a></li>
                              <li><a href="../../usage/transformations/reference/index.html">Transformation Reference</a></li>
                            </ul></li>
                            <li class="nav-parent"><a>Further Topics</a>
                            <ul class="nav nav-children">
                              <li><a href="../../usage/further/sync-vs-async.html">Sync vs. Async</a></li>
                              <li><a href="../../usage/further/pipes.html">Pipes</a></li>
                              <li><a href="../../usage/further/modules.html">Modules</a></li>
                              <li><a href="../../usage/further/debugging.html">Debugging</a></li>
                              <li><a href="../../usage/further/rendering.html">Rendering</a></li>
                              <li><a href="../../usage/further/configuration.html">Configuration</a></li>
                              <li><a href="../../usage/further/best-practices.html">Best Practices</a></li>
                            </ul></li>
                            <li class="nav-parent"><a>Domain Adapters</a>
                            <ul class="nav nav-children">
                              <li><a href="../../usage/domain/file-io.html">File IO</a></li>
                              <li><a href="../../usage/domain/tcp.html">Network IO (TCP)</a></li>
                              <li><a href="../../usage/domain/text.html">Text Transformations</a></li>
                              <li><a href="../../usage/domain/hash.html">Hashing Support</a></li>
                            </ul></li>
                            <li><a href="../../usage/swave-core-api.html">API Docs (ScalaDoc)</a></li>
                            <li><a href="../../usage/swave-akka-compat/index.html">swave-akka-compat</a></li>
                            <li><a href="../../usage/swave-scodec-compat/index.html">swave-scodec-compat</a></li>
                            <li><a href="../../usage/swave-testkit/index.html">swave-testkit</a></li>
                          </ul></li>
                          <li><a href="../../dev/index.html"><i class="fa fa-cogs" aria-hidden="true"></i><span>Developer Documentation</span></a></li>
                          <li class="nav-parent"><a><i class="fa fa-info-circle" aria-hidden="true"></i><span>Project Info</span></a>
                          <ul class="nav nav-children">
                            <li><a href="../../project/license.html">License</a></li>
                            <li><a href="../../project/contributing.html">Contributing</a></li>
                            <li><a href="../../project/changelog.html">Changelog</a></li>
                            <li><a href="../../project/sponsors.html">Sponsors</a></li>
                            <li><a href="../../project/references.html">References</a></li>
                          </ul></li>
                          <li><a href="../../support.html"><i class="fa fa-users" aria-hidden="true"></i><span>Support</span></a></li>
                        </ul>
                    </nav>
                </div>

                <script>
                    // Maintain Scroll Position
                    if (typeof localStorage !== 'undefined') {
                        if (localStorage.getItem('sidebar-left-position') !== null) {
                            var initialPosition = localStorage.getItem('sidebar-left-position'),
                                    sidebarLeft = document.querySelector('#sidebar-left .nano-content');

                            sidebarLeft.scrollTop = initialPosition;
                        }
                    }
                </script>

            </div>

        </aside>

        <section role="main" class="content-body">
            <header class="page-header">
                <ul class="breadcrumbs">
                  <li><a href="../../index.html"><i class="fa fa-home"></i></a></li>
                  <li><a href="../../usage/index.html">User Documentation</a></li>
                  <li><a href="../../usage/show-off/index.html">Show-Off</a></li>
                  <li>MD5 Example</li>
                </ul>
            </header>
            <div id="main-content">
                <!-- start: page -->
<h1><a href="#md5-example" name="md5-example" class="anchor"><span class="anchor-link"></span></a>MD5 Example</h1>
<p>This example demonstrates a small practical application of file streaming in <em>swave</em>.<br/> The following code shows how one could compute an MD5 hash string for files of arbitrary size:</p>
<pre><code class="scala">import java.security.MessageDigest
import java.io.File
import scala.concurrent.Future
import swave.core.io.files._   // enables `Spout.fromFile`
import swave.compat.scodec._   // enables `ByteVector` support
import swave.core._

implicit val env = StreamEnv()

def md5sum(file: File): Future[String] = {
  val md5 = MessageDigest.getInstance(&quot;MD5&quot;)
  Spout.fromFile(file)                                      // Spout[ByteVector]
    .fold(md5) { (m, bytes) =&gt; m.update(bytes.toArray); m } // Spout[MessageDigest]
    .flatMap(_.digest().iterator)                           // Spout[Byte]
    .map(_ &amp; 0xFF)                                          // Spout[Int]
    .map(&quot;%02x&quot; format _)                                   // Spout[String]
    .drainToMkString(limit = 32)                            // Future[String]
}

// don&#39;t forget to shutdown the StreamEnv at application exit with
// env.shutdown()</code></pre>
<p>The stream graph defined by this code is quite straight-forward (a simple pipeline), but there are still a few interesting points to discuss:</p>
<ol>
  <li>
  <p>The <a href="../spouts.html">Spout</a> produced by <code>Spout.fromFile</code> is always <a href="../further/sync-vs-async.html">asynchronous</a> and runs on the dispatcher <a href="../further/configuration.html">configured</a> under the name &ldquo;blocking-io&rdquo; (see the <a href="../domain/file-io.html">File IO</a> chapter for more details). The reason for this is that there is no general and truly asynchronous kernel API for non-blocking file IO, which causes all file system accesses to be inherently blocking. In order to mitigate the potential resource exhaustion problems that could occur in higher load scenarios all file IO operations in <em>swave</em> are fenced off from the rest of the application by confining them to the &ldquo;blocking-io&rdquo; dispatcher.</p></li>
  <li>
  <p><em>swave</em> itself doesn&rsquo;t provide an abstraction for an immutable sequence of bytes, because there already exist excellent implementations for this, for example in <a href="http://akka.io">Akka</a> or <a href="http://scodec.io">scodec</a>. Rather, <em>swave</em> defines a type class <a href="https://github.com/sirthias/swave/tree/master/core/src/main/scala/swave/core/io/Bytes.scala">Bytes</a>, which abstracts over available &ldquo;byte sequence&rdquo; implementations and also allows you to supply your own, if required. <em>swave</em> comes with support for <a href="http://doc.akka.io/api/akka/2.4/akka/util/ByteString.html">akka.util.ByteString</a> and <a href="http://scodec.org/api/scodec-bits/1.1.2/scodec/bits/ByteVector.html">scodec.bits.ByteVector</a> predefined, which can be activated with a single import (see the <a href="../domain/file-io.html">File IO</a> chapter for more details).</p></li>
  <li>
  <p>While the code above will work with files of arbitrary size the memory required during execution is &ldquo;small&rdquo; and fully bounded. All action happens in chunks of <a href="../further/configuration.html">configurable</a> size.<br/> (see setting <code>swave.core.file-io.default-file-reading-chunk-size</code>)</p></li>
  <li>
  <p>Because the <code>fromFile</code> <a href="../spouts.html">Spout</a> is asynchronous the stream pipeline in this example actually consists of two parts that are running in parallel.</p></li>
</ol>
<p>The last point deserves some further explanations.<br/> Here is a visualization of the example&rsquo;s stream pipeline:</p><div class="centered">
<p><img src="../../assets/img/md5-graph.svg" alt="MD5 Example Stream Graph" /></p></div>
<p>As you can see there is an asynchronous boundary between the first two stages of the graph, which causes both parts to run independently from each other and thus concurrently. Adding additional asynchronous boundaries, for increasing the degree of concurrency, is as easy as adding an <a href="../transformations/reference/asyncBoundary.html">.asyncBoundary()</a> transformation at arbitrary points in the pipeline.</p>
<p>This makes trying out different distribution patterns of your business logic over several threads and cores extremely easy. Adding a boundary means adding a single line of code. Moving a boundary means moving a single line of code. If you contrast that with the amount of work required for introducing, moving or removing asynchronous boundaries in traditional thread-based applications or even actor-based ones some of the benefits of stream-based programming should become apparent.</p>
<h2><a href="#improved-version" name="improved-version" class="anchor"><span class="anchor-link"></span></a>Improved Version</h2>
<p>Because computing hashes across streams of bytes is such a common task <em>swave</em> provides <a href="../domain/hash.html">built-in support for the most common hashes</a>. By relying on the <code>md5</code> transformation the example above can be somewhat simplified to the following snippet, which will also perform slightly better:</p>
<pre><code class="scala">import java.io.File
import scala.concurrent.Future
import swave.core.io.files._   // enables `Spout.fromFile`
import swave.core.hash._       // enables the `md5` transformation
import swave.compat.scodec._   // enables `ByteVector` support
import swave.core._

implicit val env = StreamEnv()

def md5sum(file: File): Future[String] =
  Spout.fromFile(file)            // Spout[ByteVector]
    .md5                          // Spout[ByteVector]
    .flattenConcat()              // Spout[Byte]
    .map(_ &amp; 0xFF)                // Spout[Int]
    .map(&quot;%02x&quot; format _)         // Spout[String]
    .drainToMkString(limit = 32)  // Future[String]

// don&#39;t forget to shutdown the StreamEnv at application exit with
// env.shutdown()</code></pre>
                <div class="nav-next">
                    <p><strong>Next:</strong> <a href="../../usage/show-off/fahrenheit.html">Fahrenheit Example</a></p>
                </div>
                <!-- end: page -->
            </div>
        </section>
    </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="../../assets/vendor/jquery.browser.mobile/jquery.browser.mobile.js"></script>
<script src="../../assets/vendor/nanoscroller/nanoscroller.js"></script>
<script src="../../assets/vendor/highlight/highlight.js"></script>
<script src="../../assets/js/theme.js"></script>
<script src="../../assets/js/theme.init.js"></script>

</body>
</html>